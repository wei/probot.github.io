<h1>Interacting with GitHub</h1><p>Probot uses <a href="https://docs.github.com/developers/apps/">GitHub Apps</a> for authorizing requests to GitHub's APIs. A registered GitHub App is a first-class actor on GitHub, like a user (e.g. <a href="https://github.com/bkeepers">@bkeepers</a>) or an organization (e.g. <a href="https://github.com/github">@github</a>). The GitHub App is granted access to all or selected repositories by being &quot;installed&quot; on a user or organization account and can perform actions through the API like <a href="https://docs.github.com/rest/reference/issues#create-an-issue-comment">commenting on an issue</a> or <a href="https://docs.github.com/rest/reference/repos#create-a-commit-status">creating a status</a>.</p><p>Your Probot app has access to an authenticated <a href="https://octokit.github.io/rest.js/">Octokit client</a> that can be used to make API calls. It supports both the <a href="https://docs.github.com/rest">GitHub REST API</a>, and the <a href="https://docs.github.com/graphql">GitHub GraphQL API</a>.</p><h2>REST API</h2><p><code>context.octokit</code> is an instance of the <a href="https://github.com/octokit/rest.js#readme"><code>@octokit/rest</code> Node.js module</a>, and allows you to do almost anything programmatically that you can do through a web browser.</p><p>Here is an example of an autoresponder app that comments on opened issues:</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"issues.opened"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// `context` extracts information from the event, which can be passed to</span><br>    <span class="token comment">// GitHub API calls. This will return:</span><br>    <span class="token comment">//   { owner: 'yourname', repo: 'yourrepo', number: 123, body: 'Hello World! }</span><br>    <span class="token keyword">const</span> params <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">issue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> body<span class="token operator">:</span> <span class="token string">"Hello World!"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Post a comment on the issue</span><br>    <span class="token keyword">return</span> context<span class="token punctuation">.</span>octokit<span class="token punctuation">.</span>issues<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>See the <a href="https://octokit.github.io/rest.js/">full API docs</a> to see all the ways you can interact with GitHub. Some API endpoints are not available on GitHub Apps yet, so check <a href="https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps">which ones are available</a> first.</p><h2>GraphQL API</h2><p>Use <code>context.octokit.graphql</code> to make requests to the <a href="https://docs.github.com/en/graphql">GitHub GraphQL API</a>.</p><p>Here is an example of the same autoresponder app from above that comments on opened issues, but this time with GraphQL:</p><pre class="language-js"><code class="language-js"><span class="token comment">// GraphQL query to add a comment</span><br><span class="token keyword">const</span> addComment <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  mutation comment($id: ID!, $body: String!) {<br>    addComment(input: {subjectId: $id, body: $body}) {<br>      clientMutationId<br>    }<br>  }<br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"issues.opened"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// Post a comment on the issue</span><br>    context<span class="token punctuation">.</span>octokit<span class="token punctuation">.</span><span class="token function">graphql</span><span class="token punctuation">(</span>addComment<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      id<span class="token operator">:</span> context<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>issue<span class="token punctuation">.</span>node_id<span class="token punctuation">,</span><br>      body<span class="token operator">:</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The options in the 2nd argument will be passed as variables to the query. You can pass custom headers by using the <code>headers</code> key:</p><pre class="language-js"><code class="language-js"><span class="token comment">// GraphQL query to pin an issue</span><br><span class="token keyword">const</span> pinIssue <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  mutation comment($id: ID!) {<br>    pinIssue(input: {subjectId: $id}) {<br>      clientMutationId<br>    }<br>  }<br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"issues.opened"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    context<span class="token punctuation">.</span>octokit<span class="token punctuation">.</span><span class="token function">graphql</span><span class="token punctuation">(</span>pinIssue<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      id<span class="token operator">:</span> context<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>issue<span class="token punctuation">.</span>node_id<span class="token punctuation">,</span><br>      headers<span class="token operator">:</span> <span class="token punctuation">{</span><br>        accept<span class="token operator">:</span> <span class="token string">"application/vnd.github.elektra-preview+json"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Check out the <a href="https://docs.github.com/en/graphql">GitHub GraphQL API docs</a> to learn more.</p><h2>Unauthenticated Events</h2><p>When <a href="./webhooks.md">receiving webhook events</a>, <code>context.octokit</code> is <em>usually</em> an authenticated client, but there are a few events that are exceptions:</p><ul><li><p><a href="https://docs.github.com/en/developers/webhooks-and-events/webhook-events-and-payloads#installation"><code>installation.deleted</code> &amp; <code>installation.suspend</code></a> - The installation was <em>just</em> deleted or suspended, so we can't authenticate as the installation.</p></li><li><p><a href="https://docs.github.com/en/developers/webhooks-and-events/webhook-events-and-payloads#marketplace_purchase"><code>marketplace_purchase</code></a> - The purchase happens before the app is installed on an account.</p></li></ul><p>For these events, <code>context.octokit</code> will be unauthenticated. Attemts to send any requests will fail with an error explaining the circumstances.</p><h2>GitHub Enterprise</h2><p>If you want to run a Probot App against a GitHub Enterprise instance, you'll need to create and set the <code>GHE_HOST</code> environment variable inside of the <code>.env</code> file.</p><pre><code>GHE_HOST=fake.github-enterprise.com
</code></pre><p>When <a href="./development.md#run-probot-programmatically">using Probot programmatically</a>, set the <code>baseUrl</code> option for the <a href="https://probot.github.io/api/latest/classes/probot.html"><code>Probot</code></a> constructor to the full base Url of the REST API</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> MyProbot <span class="token operator">=</span> Probot<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  baseUrl<span class="token operator">:</span> <span class="token string">"https://fake.github-enterprise.com/api/v3"</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>