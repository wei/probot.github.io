<h1>Logging</h1><p>Probot comes with <a href="https://getpino.io"><code>pino</code></a>, a minimal logging library that outputs <a href="http://ndjson.org/">newline delimited JSON</a>. Probot uses <a href="https://github.com/pinojs/pino-pretty"><code>pino-pretty</code></a> for more readbale formatting during development and <a href="https://github.com/probot/pino/"><code>@probot/pino</code></a> which supports error reporting to Sentry by configuring the <code>SENTRY_DSN</code> environment variable.</p><p><code>app.log</code>, <code>context.log</code> in an event handler, and <code>req.log</code> in an HTTP request are all loggers that you can use to get more information about what your app is doing.</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> <span class="token punctuation">{</span> getRouter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Yay, my app is loaded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"issues.opened"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>issue<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bacon</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      context<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"This issue is about bacon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      context<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Sadly, this issue is not about bacon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">getRouter</span><span class="token punctuation">(</span><span class="token string">"/my-app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/hello-world"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    req<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Someone is saying hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>When you start up your Probot app you should see your log message appear in your terminal.</p><p>Occasionally you will want to log more detailed information that is useful for debugging, but you might not want to see it all the time.</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// â€¦</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Really low-level logging"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token string">"here"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"End-line specs on the rotary girder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Same as using `app.log`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Some error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"Uh-oh, this may not be good"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"Yeah, it was bad"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  app<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"Goodbye, cruel world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>By default, messages that are <code>info</code> and above will show in your logs, but you can change it by setting the<br><code>LOG_LEVEL</code> environment variable to <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, or <code>fatal</code> in <code>.env</code> or on the command line.</p><pre><code>$ LOG_LEVEL=debug npm start
</code></pre><h2>Log formats</h2><p>In development, it's nice to see simple, colorized, pretty log messages. But those pretty messages don't do you any good when you have 2TB of log files and you're trying to track down why that one-in-a-million bug is happening in production.</p><p>When <code>NODE_ENV</code> is set (as it should be in production), the log output is structured JSON, which can then be drained to a logging service that allows querying by various attributes.</p><p>For example, given this log:</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"issue_comment.created"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Comment created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>You'll see this output:</p><pre><code>{&quot;name&quot;:&quot;Probot&quot;,&quot;hostname&quot;:&quot;Brandons-MacBook-Pro-3.local&quot;,&quot;pid&quot;:96993,&quot;event&quot;:{&quot;id&quot;:&quot;afdcb370-c57d-11e7-9b26-0f31120e45b8&quot;,&quot;event&quot;:&quot;issue_comment&quot;,&quot;action&quot;:&quot;created&quot;,&quot;repository&quot;:&quot;robotland/test&quot;,&quot;installation&quot;:13055},&quot;level&quot;:30,&quot;msg&quot;:&quot;Comment created&quot;,&quot;time&quot;:&quot;2017-11-09T18:42:07.312Z&quot;,&quot;v&quot;:0}
</code></pre><p>The output can then be piped to one of <a href="https://getpino.io/#/docs/transports">pino's transport tools</a>, or you can build your own.</p>